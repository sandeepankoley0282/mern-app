<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudentSync â€” Profile & Similarity</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a0f;
      --surface: #12121a;
      --surface2: #1a1a26;
      --border: #2a2a3d;
      --accent: #7c6af7;
      --accent2: #f76aaa;
      --accent3: #6af7c8;
      --text: #e8e8f0;
      --muted: #7070a0;
      --danger: #f76a6a;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'DM Mono', monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* â”€â”€ BACKGROUND GRID â”€â”€ */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(124,106,247,0.04) 1px, transparent 1px),
        linear-gradient(90deg, rgba(124,106,247,0.04) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: 0;
    }

    /* â”€â”€ GLOW ORBS â”€â”€ */
    .orb {
      position: fixed;
      border-radius: 50%;
      filter: blur(120px);
      pointer-events: none;
      z-index: 0;
    }
    .orb-1 { width: 500px; height: 500px; background: rgba(124,106,247,0.12); top: -100px; left: -100px; }
    .orb-2 { width: 400px; height: 400px; background: rgba(247,106,170,0.08); bottom: 0; right: -100px; }
    .orb-3 { width: 300px; height: 300px; background: rgba(106,247,200,0.06); top: 50%; left: 50%; transform: translate(-50%,-50%); }

    /* â”€â”€ LAYOUT â”€â”€ */
    .wrapper { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 0 24px 80px; }

    /* â”€â”€ HEADER â”€â”€ */
    header {
      padding: 48px 0 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      margin-bottom: 48px;
    }
    .logo {
      font-family: 'Syne', sans-serif;
      font-size: 1.6rem;
      font-weight: 800;
      letter-spacing: -0.03em;
    }
    .logo span { color: var(--accent); }
    .logo sub { font-size: 0.55em; color: var(--muted); font-weight: 400; margin-left: 6px; vertical-align: middle; }
    nav { display: flex; gap: 8px; }
    .nav-btn {
      background: none;
      border: 1px solid var(--border);
      color: var(--muted);
      font-family: 'DM Mono', monospace;
      font-size: 0.78rem;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.05em;
    }
    .nav-btn:hover, .nav-btn.active {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(124,106,247,0.08);
    }

    /* â”€â”€ SECTIONS â”€â”€ */
    .section { display: none; animation: fadeUp 0.4s ease; }
    .section.active { display: block; }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€ SECTION HEADER â”€â”€ */
    .section-header { margin-bottom: 32px; }
    .section-header h2 {
      font-family: 'Syne', sans-serif;
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }
    .section-header p { color: var(--muted); font-size: 0.85rem; line-height: 1.6; }

    /* â”€â”€ FORM â”€â”€ */
    .form-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 40px;
    }

    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .form-group { display: flex; flex-direction: column; gap: 8px; }
    .form-group.full { grid-column: 1 / -1; }

    label {
      font-size: 0.72rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--muted);
    }

    input, select {
      background: var(--surface2);
      border: 1px solid var(--border);
      color: var(--text);
      font-family: 'DM Mono', monospace;
      font-size: 0.88rem;
      padding: 12px 16px;
      border-radius: 8px;
      transition: border-color 0.2s, box-shadow 0.2s;
      outline: none;
      width: 100%;
    }
    input:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(124,106,247,0.15);
    }
    input::placeholder { color: var(--muted); opacity: 0.6; }

    /* Tag input */
    .tag-input-wrap {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      min-height: 48px;
      cursor: text;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .tag-input-wrap:focus-within {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(124,106,247,0.15);
    }
    .tag {
      background: rgba(124,106,247,0.2);
      color: var(--accent);
      border: 1px solid rgba(124,106,247,0.3);
      border-radius: 4px;
      padding: 2px 10px 2px 8px;
      font-size: 0.78rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tag.interest {
      background: rgba(247,106,170,0.15);
      color: var(--accent2);
      border-color: rgba(247,106,170,0.25);
    }
    .tag-remove {
      cursor: pointer;
      opacity: 0.6;
      font-size: 0.9rem;
      line-height: 1;
    }
    .tag-remove:hover { opacity: 1; }
    .tag-input-wrap input {
      border: none;
      background: transparent;
      padding: 2px 4px;
      flex: 1;
      min-width: 100px;
      font-size: 0.82rem;
      box-shadow: none;
    }
    .tag-hint { font-size: 0.72rem; color: var(--muted); margin-top: 4px; }

    /* GPA slider */
    .gpa-row { display: flex; align-items: center; gap: 16px; }
    .gpa-row input[type=range] {
      -webkit-appearance: none;
      appearance: none;
      flex: 1;
      height: 4px;
      background: var(--border);
      border: none;
      border-radius: 2px;
      padding: 0;
      box-shadow: none;
      cursor: pointer;
    }
    .gpa-row input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px; height: 18px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
      box-shadow: 0 0 8px rgba(124,106,247,0.5);
    }
    .gpa-val {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--accent);
      min-width: 36px;
      text-align: center;
    }

    /* Submit btn */
    .btn {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 0.9rem;
      letter-spacing: 0.04em;
      padding: 14px 32px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: var(--accent);
      color: #fff;
    }
    .btn-primary:hover { background: #9080fa; transform: translateY(-1px); box-shadow: 0 8px 24px rgba(124,106,247,0.3); }
    .btn-primary:active { transform: translateY(0); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-ghost {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
    }
    .btn-ghost:hover { background: rgba(124,106,247,0.1); }
    .btn-danger {
      background: transparent;
      color: var(--danger);
      border: 1px solid rgba(247,106,106,0.3);
      font-size: 0.75rem;
      padding: 6px 12px;
    }
    .btn-danger:hover { background: rgba(247,106,106,0.1); }

    .form-actions { margin-top: 28px; display: flex; gap: 12px; align-items: center; }

    /* Toast */
    #toast {
      position: fixed;
      bottom: 32px;
      right: 32px;
      z-index: 100;
      padding: 14px 24px;
      border-radius: 10px;
      font-size: 0.85rem;
      font-family: 'DM Mono', monospace;
      transform: translateY(80px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: none;
    }
    #toast.show { transform: translateY(0); opacity: 1; }
    #toast.success { background: rgba(106,247,200,0.15); border: 1px solid rgba(106,247,200,0.3); color: var(--accent3); }
    #toast.error   { background: rgba(247,106,106,0.15); border: 1px solid rgba(247,106,106,0.3); color: var(--danger); }

    /* â”€â”€ STUDENTS GRID â”€â”€ */
    .students-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }

    .student-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      transition: border-color 0.2s, transform 0.2s;
      position: relative;
      overflow: hidden;
    }
    .student-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      opacity: 0;
      transition: opacity 0.2s;
    }
    .student-card:hover { border-color: rgba(124,106,247,0.4); transform: translateY(-2px); }
    .student-card:hover::before { opacity: 1; }

    .card-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 16px; }
    .card-avatar {
      width: 44px; height: 44px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display: flex; align-items: center; justify-content: center;
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 1.1rem;
      color: white;
      flex-shrink: 0;
    }
    .card-name {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 1rem;
      margin-bottom: 2px;
    }
    .card-major { font-size: 0.78rem; color: var(--muted); }

    .card-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
    .stat { background: var(--surface2); border-radius: 6px; padding: 8px 10px; }
    .stat-label { font-size: 0.65rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 2px; }
    .stat-val { font-size: 0.9rem; font-weight: 500; color: var(--accent); }

    .tag-list { display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 16px; }
    .tag-pill {
      font-size: 0.68rem;
      padding: 2px 8px;
      border-radius: 20px;
      background: rgba(124,106,247,0.12);
      color: rgba(124,106,247,0.9);
      border: 1px solid rgba(124,106,247,0.2);
    }
    .tag-pill.int {
      background: rgba(247,106,170,0.1);
      color: rgba(247,106,170,0.9);
      border-color: rgba(247,106,170,0.2);
    }

    .card-actions { display: flex; gap: 8px; justify-content: flex-end; }
    .btn-similar {
      font-family: 'DM Mono', monospace;
      font-size: 0.75rem;
      padding: 7px 14px;
      border-radius: 6px;
      border: 1px solid rgba(106,247,200,0.3);
      background: rgba(106,247,200,0.07);
      color: var(--accent3);
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-similar:hover { background: rgba(106,247,200,0.14); }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: var(--muted);
      grid-column: 1 / -1;
    }
    .empty-icon { font-size: 3rem; margin-bottom: 16px; opacity: 0.5; }
    .empty-state p { font-size: 0.88rem; }

    /* Loading */
    .spinner {
      width: 20px; height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
      display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ SIMILARITY MODAL â”€â”€ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      z-index: 50;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      width: 100%;
      max-width: 640px;
      max-height: 85vh;
      overflow-y: auto;
      animation: fadeUp 0.3s ease;
    }
    .modal-header {
      padding: 28px 28px 0;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 24px;
    }
    .modal-title {
      font-family: 'Syne', sans-serif;
      font-size: 1.2rem;
      font-weight: 700;
    }
    .modal-subtitle { font-size: 0.78rem; color: var(--muted); margin-top: 4px; }
    .modal-close {
      background: none; border: none; cursor: pointer;
      color: var(--muted); font-size: 1.4rem; line-height: 1;
      padding: 4px;
    }
    .modal-close:hover { color: var(--text); }
    .modal-body { padding: 0 28px 28px; }

    .similar-item {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 10px;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 12px;
      align-items: center;
      transition: border-color 0.2s;
    }
    .similar-item:hover { border-color: rgba(124,106,247,0.3); }
    .rank {
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 1.2rem;
      color: var(--border);
      min-width: 28px;
      text-align: center;
    }
    .rank-1 { color: #f7c96a; }
    .rank-2 { color: #b0b8c8; }
    .rank-3 { color: #c87a5a; }
    .similar-name {
      font-family: 'Syne', sans-serif;
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 2px;
    }
    .similar-meta { font-size: 0.75rem; color: var(--muted); }
    .score-badge {
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 1.1rem;
      text-align: right;
    }
    .score-bar-wrap { margin-top: 8px; }
    .score-bar-row { display: flex; gap: 8px; align-items: center; margin-bottom: 4px; }
    .score-bar-label { font-size: 0.67rem; color: var(--muted); width: 60px; flex-shrink: 0; }
    .score-bar-bg { flex: 1; height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
    .score-bar-fill { height: 100%; border-radius: 2px; transition: width 0.8s ease; }
    .fill-skills   { background: var(--accent); }
    .fill-interests{ background: var(--accent2); }
    .fill-major    { background: var(--accent3); }
    .fill-gpa      { background: #f7c96a; }
    .score-bar-pct { font-size: 0.67rem; color: var(--muted); width: 30px; text-align: right; }

    /* â”€â”€ RESPONSIVE â”€â”€ */
    @media (max-width: 640px) {
      .form-grid { grid-template-columns: 1fr; }
      header { flex-direction: column; gap: 20px; align-items: flex-start; }
      .form-card { padding: 24px; }
    }
  </style>
</head>
<body>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>

  <div class="wrapper">
    <header>
      <div class="logo">Student<span>Sync</span><sub>v1.0</sub></div>
      <nav>
        <button class="nav-btn active" onclick="showSection('form')">+ Add Profile</button>
        <button class="nav-btn" onclick="showSection('students')">All Students</button>
      </nav>
    </header>

    <!-- â”€â”€ ADD PROFILE â”€â”€ -->
    <section id="section-form" class="section active">
      <div class="section-header">
        <h2>Add Student Profile</h2>
        <p>Fill in the form below. Skills and interests accept comma-separated entries or press Enter/Tab to add tags.</p>
      </div>

      <div class="form-card">
        <form id="profileForm">
          <div class="form-grid">

            <div class="form-group">
              <label for="name">Full Name</label>
              <input type="text" id="name" placeholder="e.g. Aanya Sharma" required />
            </div>

            <div class="form-group">
              <label for="age">Age</label>
              <input type="number" id="age" placeholder="e.g. 21" min="10" max="100" required />
            </div>

            <div class="form-group full">
              <label for="major">Major / Department</label>
              <input type="text" id="major" placeholder="e.g. Computer Science" required />
            </div>

            <div class="form-group full">
              <label>GPA (0.0 â€“ 4.0)</label>
              <div class="gpa-row">
                <input type="range" id="gpa" min="0" max="4" step="0.1" value="3.0" oninput="document.getElementById('gpaVal').textContent = parseFloat(this.value).toFixed(1)" />
                <div class="gpa-val" id="gpaVal">3.0</div>
              </div>
            </div>

            <div class="form-group full">
              <label>Skills</label>
              <div class="tag-input-wrap" id="skillsWrap" onclick="this.querySelector('input').focus()">
                <input type="text" id="skillInput" placeholder="Type a skill and press Enter..." autocomplete="off" />
              </div>
              <div class="tag-hint">e.g. Python, Machine Learning, React</div>
            </div>

            <div class="form-group full">
              <label>Interests</label>
              <div class="tag-input-wrap" id="interestsWrap" onclick="this.querySelector('input').focus()">
                <input type="text" id="interestInput" placeholder="Type an interest and press Enter..." autocomplete="off" />
              </div>
              <div class="tag-hint">e.g. AI Research, Open Source, Music</div>
            </div>

          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submitBtn">Save Profile</button>
            <button type="button" class="btn btn-ghost" onclick="resetForm()">Clear</button>
            <span id="formStatus"></span>
          </div>
        </form>
      </div>
    </section>

    <!-- â”€â”€ ALL STUDENTS â”€â”€ -->
    <section id="section-students" class="section">
      <div class="section-header" style="display:flex;justify-content:space-between;align-items:flex-start;">
        <div>
          <h2>Student Profiles</h2>
          <p>Click "Find Similar" on any card to compute similarity scores against all other students.</p>
        </div>
        <button class="btn btn-ghost" onclick="loadStudents()" style="font-size:0.8rem;padding:8px 16px;margin-top:4px;">â†» Refresh</button>
      </div>
      <div class="students-grid" id="studentsGrid">
        <div class="empty-state"><div class="spinner"></div></div>
      </div>
    </section>
  </div>

  <!-- â”€â”€ SIMILARITY MODAL â”€â”€ -->
  <div class="modal-overlay" id="modalOverlay" onclick="e => { if(e.target===this) closeModal(); }">
    <div class="modal" id="modal">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="modalTitle">Similar Students</div>
          <div class="modal-subtitle" id="modalSubtitle"></div>
        </div>
        <button class="modal-close" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modal-body" id="modalBody"></div>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    const API = '/api/students';
    const skills = [];
    const interests = [];

    // â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('section-' + id).classList.add('active');
      event.target.classList.add('active');
      if (id === 'students') loadStudents();
    }

    // â”€â”€ Tag input logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setupTagInput(inputId, wrapId, arr, type) {
      const input = document.getElementById(inputId);
      const wrap  = document.getElementById(wrapId);

      function addTag(val) {
        val = val.trim();
        if (!val || arr.includes(val.toLowerCase())) return;
        arr.push(val.toLowerCase());
        const tag = document.createElement('span');
        tag.className = 'tag' + (type === 'interest' ? ' interest' : '');
        tag.innerHTML = `${val} <span class="tag-remove" onclick="removeTag('${val}','${type}',this)">Ã—</span>`;
        wrap.insertBefore(tag, input);
        input.value = '';
      }

      input.addEventListener('keydown', e => {
        if (['Enter','Tab',','].includes(e.key)) {
          e.preventDefault();
          addTag(input.value);
        }
        if (e.key === 'Backspace' && !input.value && arr.length) {
          const last = arr.pop();
          wrap.querySelectorAll('.tag').forEach(t => { if(t.textContent.trim().startsWith(last)) t.remove(); });
        }
      });
      input.addEventListener('blur', () => addTag(input.value));
    }

    function removeTag(val, type, el) {
      const arr = type === 'interest' ? interests : skills;
      const idx = arr.indexOf(val.toLowerCase());
      if (idx > -1) arr.splice(idx, 1);
      el.parentElement.remove();
    }

    setupTagInput('skillInput', 'skillsWrap', skills, 'skill');
    setupTagInput('interestInput', 'interestsWrap', interests, 'interest');

    // â”€â”€ Form submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('profileForm').addEventListener('submit', async e => {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      btn.disabled = true;
      btn.textContent = 'Saving...';

      // Flush any typed-but-not-committed tags
      ['skillInput','interestInput'].forEach(id => {
        const el = document.getElementById(id);
        if (el.value.trim()) el.dispatchEvent(new Event('blur'));
      });

      const payload = {
        name:      document.getElementById('name').value.trim(),
        age:       document.getElementById('age').value,
        major:     document.getElementById('major').value.trim(),
        gpa:       parseFloat(document.getElementById('gpa').value),
        skills:    [...skills],
        interests: [...interests],
      };

      try {
        const res = await fetch(API, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Failed to save');
        showToast('âœ“ Profile saved for ' + payload.name, 'success');
        resetForm();
      } catch(err) {
        showToast('âœ• ' + err.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Save Profile';
      }
    });

    function resetForm() {
      document.getElementById('profileForm').reset();
      document.getElementById('gpaVal').textContent = '3.0';
      skills.length = 0; interests.length = 0;
      ['skillsWrap','interestsWrap'].forEach(id => {
        const wrap = document.getElementById(id);
        wrap.querySelectorAll('.tag').forEach(t => t.remove());
      });
    }

    // â”€â”€ Load students â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadStudents() {
      const grid = document.getElementById('studentsGrid');
      grid.innerHTML = '<div class="empty-state"><div class="spinner"></div></div>';
      try {
        const res  = await fetch(API);
        const data = await res.json();
        if (!data.data.length) {
          grid.innerHTML = `<div class="empty-state"><div class="empty-icon">ðŸ‘¤</div><p>No students yet. Add the first profile!</p></div>`;
          return;
        }
        grid.innerHTML = data.data.map(studentCard).join('');
      } catch(err) {
        grid.innerHTML = `<div class="empty-state"><p>Error loading students: ${err.message}</p></div>`;
      }
    }

    function initials(name) {
      return name.split(' ').map(w => w[0]).join('').slice(0,2).toUpperCase();
    }

    function studentCard(s) {
      const skillTags   = (s.skills   || []).slice(0,4).map(t => `<span class="tag-pill">${t}</span>`).join('');
      const interestTags= (s.interests|| []).slice(0,3).map(t => `<span class="tag-pill int">${t}</span>`).join('');
      return `
        <div class="student-card">
          <div class="card-top">
            <div style="display:flex;gap:12px;align-items:center;">
              <div class="card-avatar">${initials(s.name)}</div>
              <div>
                <div class="card-name">${s.name}</div>
                <div class="card-major">${s.major}</div>
              </div>
            </div>
          </div>
          <div class="card-stats">
            <div class="stat"><div class="stat-label">Age</div><div class="stat-val">${s.age}</div></div>
            <div class="stat"><div class="stat-label">GPA</div><div class="stat-val">${parseFloat(s.gpa).toFixed(1)}</div></div>
          </div>
          <div class="tag-list">${skillTags}${interestTags}</div>
          <div class="card-actions">
            <button class="btn-danger" onclick="deleteStudent('${s._id}')">Delete</button>
            <button class="btn-similar" onclick="findSimilar('${s._id}', '${s.name.replace(/'/g,"\\'")}')">âŸ³ Find Similar</button>
          </div>
        </div>
      `;
    }

    // â”€â”€ Delete student â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function deleteStudent(id) {
      if (!confirm('Delete this student?')) return;
      try {
        await fetch(`${API}/${id}`, { method: 'DELETE' });
        showToast('Deleted', 'success');
        loadStudents();
      } catch(err) {
        showToast('Delete failed', 'error');
      }
    }

    // â”€â”€ Similarity modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function findSimilar(id, name) {
      document.getElementById('modalTitle').textContent = `Similar to ${name}`;
      document.getElementById('modalSubtitle').textContent = 'Computing similarity scoresâ€¦';
      document.getElementById('modalBody').innerHTML = '<div style="text-align:center;padding:32px"><div class="spinner"></div></div>';
      document.getElementById('modalOverlay').classList.add('open');

      try {
        const res  = await fetch(`${API}/${id}/similar?limit=8`);
        const data = await res.json();

        document.getElementById('modalSubtitle').textContent =
          `Top ${data.results.length} matches from ${data.results.length + (data.results.length >= 8 ? '+' : '')} students`;

        if (!data.results.length) {
          document.getElementById('modalBody').innerHTML =
            '<p style="color:var(--muted);text-align:center;padding:32px">No other students to compare yet.</p>';
          return;
        }

        const scoreColor = s => s >= 0.7 ? 'var(--accent3)' : s >= 0.4 ? 'var(--accent)' : 'var(--muted)';

        document.getElementById('modalBody').innerHTML = data.results.map((r, i) => `
          <div class="similar-item">
            <div class="rank rank-${i+1}">#${i+1}</div>
            <div>
              <div class="similar-name">${r.student.name}</div>
              <div class="similar-meta">${r.student.major} Â· GPA ${parseFloat(r.student.gpa).toFixed(1)} Â· Age ${r.student.age}</div>
              <div class="score-bar-wrap">
                <div class="score-bar-row">
                  <div class="score-bar-label">Skills</div>
                  <div class="score-bar-bg"><div class="score-bar-fill fill-skills" style="width:${r.breakdown.skills}%"></div></div>
                  <div class="score-bar-pct">${r.breakdown.skills}%</div>
                </div>
                <div class="score-bar-row">
                  <div class="score-bar-label">Interests</div>
                  <div class="score-bar-bg"><div class="score-bar-fill fill-interests" style="width:${r.breakdown.interests}%"></div></div>
                  <div class="score-bar-pct">${r.breakdown.interests}%</div>
                </div>
                <div class="score-bar-row">
                  <div class="score-bar-label">Major</div>
                  <div class="score-bar-bg"><div class="score-bar-fill fill-major" style="width:${r.breakdown.major}%"></div></div>
                  <div class="score-bar-pct">${r.breakdown.major}%</div>
                </div>
                <div class="score-bar-row">
                  <div class="score-bar-label">GPA</div>
                  <div class="score-bar-bg"><div class="score-bar-fill fill-gpa" style="width:${r.breakdown.gpa}%"></div></div>
                  <div class="score-bar-pct">${r.breakdown.gpa}%</div>
                </div>
              </div>
            </div>
            <div class="score-badge" style="color:${scoreColor(r.score)}">${Math.round(r.score*100)}%</div>
          </div>
        `).join('');
      } catch(err) {
        document.getElementById('modalBody').innerHTML = `<p style="color:var(--danger)">Error: ${err.message}</p>`;
      }
    }

    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('open');
    }
    document.getElementById('modalOverlay').addEventListener('click', e => {
      if (e.target === document.getElementById('modalOverlay')) closeModal();
    });

    // â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let toastTimer;
    function showToast(msg, type) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = `show ${type}`;
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
    }
  </script>
</body>
</html>